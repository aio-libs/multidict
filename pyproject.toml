[build-system]
requires = ["setuptools >= 40"]
build-backend = "setuptools.build_meta"


[tool.cibuildwheel]
test-requires = "-r requirements/pytest.txt"
test-command = "pytest {project}/tests"
# don't build PyPy wheels, install from source instead
skip = "pp*"
free-threaded-support = true

[tool.cibuildwheel.linux]
before-all = "yum install -y libffi-devel || apk add --upgrade libffi-dev || apt-get install libffi-dev"


[tool.coverage.html]
show_contexts = true
skip_covered = false

[tool.coverage.paths]
_site-packages-to-src-mapping = [
  ".",
  "*/lib/pypy*/site-packages",
  "*/lib/python*/site-packages",
  "*\Lib\site-packages"
]

[tool.coverage.run]
branch = true
cover_pylib = false
# https://coverage.rtfd.io/en/latest/contexts.html#dynamic-contexts
# dynamic_context = test_function  # conflicts with `pytest-cov` if set here
parallel = true
# plugins =
#   covdefaults
relative_files = true
#source = [
#  ".",
# ]
source_pkgs = ['multidict']

[tool.coverage.report]
exclude_also = [
    "if TYPE_CHECKING",
    "assert False",
    ": \.\.\.(\s*#.*)?$",
    "^ +\.\.\.$"
]
skip_covered = true
skip_empty = true
show_missing = true
